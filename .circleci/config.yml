version: 2.1
orbs:
  bats: circleci/bats@1.0.0

jobs:
  build:
    # Use `docker:stable` as the Docker container to run this job in
    docker:
      - image: docker:stable

    steps:
      # Checkout the repository files
      - checkout

      # Set up a separate Docker environment to run `docker` commands in
      - setup_remote_docker

      # Lint Dockerfile
      - run:
          name: Lint Dockerfile
          command: |
            script/lint
      
      # Build the image
      - run:
          name: Build Docker image
          command: |
            script/build

      # Test the image
      - bats/run:
          path: script/test
